<div class="breakdown-row mt-4">
  <div class="card card--breakdown shadow-none p-4 flex-1 flex justify-between">
    <div class="stat stat--small">
      <span class="stat__label">Amount raised</span>
      <span class="stat__value"><%= render_money_amount @event.total_raised %></span>
    </div>
    <div class="stat stat--small">
      <span class="stat__label">Amount spent</span>
      <span class="stat__value"><%= render_money_amount @event.total_raised - @event.balance %></span>
    </div>
  </div>
</div>

<div class="card card--breakdown shadow-none p-4 flex-1 flex flex-col">
  <h4 class="breakdown-eyebrow mt-2 mb-3" style="font-size: 16px">
    <%= @past_year_transactions_count %> <%= "transaction".pluralize(@past_year_transactions_count) %> in the past year
  </h4>

  <div class="grid-container mb2">
    <% 7.times do |x| %>
      <% 53.times do |y| %>
        <% entry = @heatmap.to_a[y * 7 + x][1] %>
        <% label = @heatmap.to_a[y * 7 + x][0] %>
        <% pos_bg = "rgba(57, 211, 83, #{Math.log(entry[:positive]) / Math.log(@maximum_positive_change)})" %>
        <% neg_bg = "rgba(248, 81, 73, #{Math.log(entry[:negative].abs) / Math.log(@maximum_negative_change.abs)})" %>
        <% if entry[:positive] > entry[:negative].abs %>
          <div class="grid-item tooltipped tooltipped--s border-muted dark:border-dark"
              aria-label="<%= "#{label}: #{render_money(entry[:positive])}" %>"
              style="background-color: <%= pos_bg %>">
          </div>
        <% elsif entry[:negative].abs > entry[:positive] %>
          <div class="grid-item tooltipped tooltipped--s border-muted dark:border-dark"
              aria-label="<%= "#{label}: #{render_money(entry[:negative])}" %>"
              style="background-color: <%= neg_bg %>">
          </div>
        <% else %>
          <div class="grid-item tooltipped tooltipped--s bg-snow dark:bg-darkless border-muted dark:border-dark"
              aria-label="<%= label %>"></div>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <div class="grid-container grid-container--preview mb3">
    <% 5.times do |x| %>
      <% pos_bg = "rgba(57, 211, 83, #{Math.log(x + 2) / Math.log(6)})" %>
      <div class="grid-item border-muted dark:border-dark" style="background-color: <%= pos_bg %>"></div>
    <% end %>
    <span style="height: 0px !important; grid-column: 6 / 20; font-size: 16px; transform: translate(4px, -5px);">MORE INCOME</span>
    <% 5.times do |x| %>
      <% neg_bg = "rgba(248, 81, 73, #{Math.log(x + 2) / Math.log(6)})" %>
      <div class="grid-item border-muted dark:border-dark" style="background-color: <%= neg_bg %>"></div>
    <% end %>
    <span style="height: 0px !important; grid-column: 25 / 40; font-size: 16px; transform: translate(4px, -5px);">MORE SPENDING</span>
  </div>
</div>

<%# locals: (content: nil) %>

<%= form_with model: @announcement, url: content.present? ? event_announcement_path(@event, @announcement) : event_announcements_path(@event), data: { controller: "tiptap", "tiptap-target": "form", "tiptap-content-value": content, "tiptap-editable-value": true, "turbo-frame": "_top" }.compact do |form| %>
  <div class="field">
    <%= form.label :title %>
    <%= form.text_field :title, required: true, placeholder: "#{@event.name}' June Update" %>
  </div>

  <div class="field">
    <%= form.label :content %>
    <%= form.hidden_field :content, data: { "tiptap-target": "contentInput" } %>
    <div>
      <div class="flex gap-2 card p-2 rounded-b-none dark:border-b-dark border-b-snow border-b-2 border-solid border-0">
        <%= render partial: "announcements/format_menu" %>
      </div>
      <div data-tiptap-target="editor" class="dark:bg-darkless bg-white p-2 rounded-md rounded-t-none"></div>
      <p class="h5 muted mt0 mb1">
        <%= link_to "https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#table-of-contents", target: "_blank", class: "flex items-center" do %>
          <%= inline_icon "markdown", size: 32 %> Styling with Markdown is supported
        <% end %>
      </p>
    </div>
  </div>

  <%= form.hidden_field :autosave, data: { "tiptap-target": "autosaveInput" } %>

  <% if content.present? %>
    <div>
      <p class="italic text-muted">Your changes automatically save</p>
      <%= link_to event_announcement_path(@event, @announcement), method: :get, class: "btn" do %>
        <%= inline_icon "reply" %> Back
      <% end %>
    </div>
  <% else %>
    <%= dropdown_button form:,
      options: [
        ["Publish now", false, "Publish this post instantly."],
        ["Create draft", true, "Save as a draft to publish later."]
      ],
      button_icon: "send",
      name: "draft",
      button_options: { data: { action: "tiptap#submit" }, type: "button" },
      menu_class: "relative",
      template: ->(value) { value ? "Create draft" : "Publish now" } %>
  <% end %>
<% end %>
